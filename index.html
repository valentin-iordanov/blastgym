<!doctype html>
<html lang="bg">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />
        <title>Blast Gaming - Твоята Карта</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- Библиотека за генериране на QR код -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
        <!-- Библиотека за превръщане на HTML в изображение -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
        <link
            href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;700&display=swap"
            rel="stylesheet"
        />
        <style>
            :root {
                --neon-green: #82ff00;
                --dark-bg: #0a0a0a;
            }
            body {
                background-color: var(--dark-bg);
                color: white;
                font-family: "Inter", sans-serif;
                overflow-x: hidden;
                -webkit-tap-highlight-color: transparent;
            }
            .gaming-font {
                font-family: "Orbitron", sans-serif;
            }

            .bg-lightning {
                background:
                    radial-gradient(
                        circle at 50% 50%,
                        rgba(130, 255, 0, 0.08) 0%,
                        transparent 70%
                    ),
                    url("https://www.transparenttextures.com/patterns/carbon-fibre.png");
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: -1;
                opacity: 0.5;
            }

            @keyframes fadeInScale {
                from {
                    opacity: 0;
                    transform: scale(0.9);
                }
                to {
                    opacity: 1;
                    transform: scale(1);
                }
            }

            .card-container {
                animation: fadeInScale 0.6s ease-out forwards;
            }

            #member-card {
                width: 340px;
                height: 520px;
                background: linear-gradient(135deg, #121212 0%, #000000 100%);
                border: 2px solid var(--neon-green);
                border-radius: 24px;
                position: relative;
                overflow: hidden;
                box-shadow: 0 0 40px rgba(130, 255, 0, 0.15);
                padding: 32px;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: space-between;
            }

            .card-glow {
                position: absolute;
                top: -20%;
                right: -20%;
                width: 100%;
                height: 100%;
                background: radial-gradient(
                    circle,
                    rgba(130, 255, 0, 0.1) 0%,
                    transparent 70%
                );
                pointer-events: none;
            }

            .qr-container {
                background: white;
                padding: 14px;
                border-radius: 20px;
                box-shadow: 0 0 25px rgba(130, 255, 0, 0.4);
            }

            .neon-text {
                color: var(--neon-green);
                text-shadow: 0 0 12px rgba(130, 255, 0, 0.6);
            }

            .save-btn {
                background: var(--neon-green);
                color: black;
                font-weight: 800;
                text-transform: uppercase;
                letter-spacing: 1px;
                transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                box-shadow: 0 4px 15px rgba(130, 255, 0, 0.3);
            }
            .save-btn:active {
                transform: scale(0.95);
            }

            .scan-line {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 2px;
                background: var(--neon-green);
                opacity: 0.3;
                box-shadow: 0 0 10px var(--neon-green);
                animation: scan 4s linear infinite;
            }

            @keyframes scan {
                0% {
                    top: 0;
                }
                100% {
                    top: 100%;
                }
            }
        </style>
    </head>
    <body class="flex flex-col items-center justify-center min-h-screen p-6">
        <div class="bg-lightning"></div>

        <!-- Заглавие -->
        <div class="text-center mb-6 card-container">
            <h1 class="gaming-font text-4xl font-black neon-text mb-1 italic">
                BLAST
            </h1>
            <p class="text-white text-xs tracking-[0.3em] uppercase opacity-70">
                Official Gaming Network
            </p>
        </div>

        <!-- КАРТАТА -->
        <div
            id="member-card-wrapper"
            class="mb-8 card-container"
            style="animation-delay: 0.2s"
        >
            <div id="member-card">
                <div class="card-glow"></div>
                <div class="scan-line"></div>

                <!-- Header -->
                <div class="w-full flex justify-between items-start">
                    <div>
                        <p
                            class="gaming-font text-[9px] text-zinc-500 uppercase tracking-widest"
                        >
                            Membership
                        </p>
                        <p
                            class="text-[10px] text-green-500 font-bold uppercase tracking-wider"
                        >
                            ● Permanent Access
                        </p>
                    </div>
                    <div class="text-right">
                        <p
                            class="gaming-font text-[9px] text-zinc-500 uppercase tracking-widest"
                        >
                            Issued
                        </p>
                        <p
                            id="current-year-display"
                            class="text-[10px] text-white font-bold uppercase"
                        ></p>
                    </div>
                </div>

                <!-- QR Code Section -->
                <div
                    class="flex flex-col items-center justify-center flex-grow"
                >
                    <div id="qrcode" class="qr-container mb-4 scale-125"></div>
                    <p
                        class="text-[9px] text-zinc-600 uppercase tracking-[0.5em] mt-6"
                    >
                        Digital Identity
                    </p>
                </div>

                <!-- Footer Section -->
                <div class="w-full">
                    <div class="flex flex-col items-center mb-6">
                        <div class="flex items-center gap-3">
                            <div
                                class="w-2 h-2 rounded-full bg-green-500 shadow-[0_0_10px_#82ff00]"
                            ></div>
                            <span
                                class="gaming-font text-[14px] text-white font-bold uppercase tracking-[0.3em]"
                                >Elite Gamer</span
                            >
                            <div
                                class="w-2 h-2 rounded-full bg-green-500 shadow-[0_0_10px_#82ff00]"
                            ></div>
                        </div>
                    </div>

                    <div
                        class="bg-zinc-900/60 backdrop-blur-md rounded-2xl p-4 border border-zinc-800/50"
                    >
                        <div class="flex items-center gap-4">
                            <div
                                class="min-w-[40px] h-[40px] rounded-full border border-green-500/30 flex items-center justify-center bg-black/50"
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="h-5 w-5 text-green-500"
                                    viewBox="0 0 20 20"
                                    fill="currentColor"
                                >
                                    <path
                                        d="M11 17a1 1 0 001.447.894l4-2A1 1 0 0017 15V9.236a1 1 0 00-1.447-.894l-4 2a1 1 0 00-.553.894V17zM15.211 6.276a1 1 0 000-1.788l-4.764-2.382a1 1 0 00-.894 0L4.789 4.488a1 1 0 000 1.788l4.764 2.382a1 1 0 00.894 0l4.764-2.382zM4.447 8.342A1 1 0 003 9.236V15a1 1 0 00.553.894l4 2A1 1 0 009 17v-5.764a1 1 0 00-.553-.894l-4-2z"
                                    />
                                </svg>
                            </div>
                            <p class="text-[10px] text-zinc-300 leading-snug">
                                Представете този QR код на рецепцията за
                                незабавен достъп до PS5 зоните в Blast Gaming.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Бутони -->
        <div
            class="flex flex-col gap-4 w-full max-w-[340px] card-container"
            style="animation-delay: 0.4s"
        >
            <button
                id="save-btn"
                onclick="downloadCard()"
                class="save-btn py-5 px-8 rounded-2xl gaming-font text-sm flex items-center justify-center gap-3"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-6 w-6"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2.5"
                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                    />
                </svg>
                Запази в Галерията
            </button>
            <p
                class="text-zinc-600 text-[9px] text-center uppercase tracking-[0.3em] font-bold opacity-60"
            >
                Blast Gaming Identity Protocol
            </p>
        </div>

        <!-- Модал при успех -->
        <div
            id="status-msg"
            class="fixed inset-0 bg-black/90 flex items-center justify-center z-50 hidden"
        >
            <div
                class="bg-zinc-900 border border-green-500 p-10 rounded-[40px] text-center max-w-[85%]"
            >
                <div
                    class="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-6 shadow-[0_0_30px_#82ff00]"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-12 w-12 text-black"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="4"
                            d="M5 13l4 4L19 7"
                        />
                    </svg>
                </div>
                <h2 class="gaming-font text-2xl text-white mb-3">ГОТОВО!</h2>
                <p class="text-zinc-400 text-sm">
                    Твоята карта беше генерирана и запазена успешно.
                </p>
            </div>
        </div>

        <script>
            // Автоматично задаване на годината
            const currentYear = new Date().getFullYear();
            document.getElementById("current-year-display").innerText =
                `${currentYear} EST.`;

            /**
             * Генерира КРИПТОГРАФСКИ УНИКАЛЕН идентификатор.
             * Комбинира точното време в милисекунди с 32-битови случайни числа.
             * Шансът за дубликат е практически нулев дори при 5+ милиона записа.
             */
            function generateSecureID() {
                // 1. Вземаме времето в база 36 (уникално спрямо времето)
                const timestamp = Date.now().toString(36).toUpperCase();

                // 2. Генерираме криптографски случайни байтове
                const array = new Uint32Array(2);
                window.crypto.getRandomValues(array);
                const randomPart = Array.from(array)
                    .map((b) => b.toString(36).toUpperCase())
                    .join("-")
                    .substring(0, 10);

                return `BLAST-${timestamp}-${randomPart}`;
            }

            const fullUniqueID = generateSecureID();

            // Генериране на QR кода
            const qrcodeContainer = document.getElementById("qrcode");
            new QRCode(qrcodeContainer, {
                text: `blast_member:${fullUniqueID}`,
                width: 160,
                height: 160,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H,
            });

            async function downloadCard() {
                const cardElement = document.getElementById("member-card");
                const statusMsg = document.getElementById("status-msg");
                const saveBtn = document.getElementById("save-btn");

                saveBtn.disabled = true;
                saveBtn.style.opacity = "0.5";
                saveBtn.innerText = "Генериране...";

                try {
                    await new Promise((r) => setTimeout(r, 400));

                    const canvas = await html2canvas(cardElement, {
                        backgroundColor: "#0a0a0a",
                        scale: 3,
                        useCORS: true,
                        borderRadius: 24,
                        logging: false,
                    });

                    const image = canvas.toDataURL("image/png");

                    const link = document.createElement("a");
                    link.download = `Blast-Member-Card.png`;
                    link.href = image;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    statusMsg.classList.remove("hidden");
                    setTimeout(() => {
                        statusMsg.classList.add("hidden");
                        saveBtn.disabled = false;
                        saveBtn.style.opacity = "1";
                        saveBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        Запази в Галерията
                    `;
                    }, 2500);
                } catch (error) {
                    console.error("Грешка:", error);
                    alert("Моля, направете скрийншот.");
                    saveBtn.disabled = false;
                    saveBtn.style.opacity = "1";
                }
            }
        </script>
    </body>
</html>
